
# rvos 编写经验

在启动过程完成之后，已经进入多线程，在main函数里面 试试print,会发现直接出现了三个 hello rvos。，每个线程发送一个，但是每次运行打印的顺序完全不同。 这个时候我们就需要用到锁了。

我们需要给print整个代码上锁，让它在一次打印中不会被中断，这样就能正常打印了。

锁利用的是编译器自带的指令。记得在用锁时需要关闭中断。锁里面保存一个cpu的结构体是为了方便管理关中断的深度。

当最基础的锁有了之后，感觉可以开始考虑内存的问题了。下一步装载页表和内存分配。

这里有一个问题

```c
int i =0 ;

for(i =0; i<100;i++ ){
    j =i+j
}
print("%d \n", i);
```

这段代码，我对i 加锁之后会出现bug 以我现在的水平 我并不知道问题处在哪儿， 我猜是需要对同步原语有一定了解才行。